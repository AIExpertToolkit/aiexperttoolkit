<nav class="toc" aria-label="Table of contents">
  <strong class="toc__title">On this page</strong>
  <ol class="toc__list" id="toc-list"></ol>
</nav>

<style>
  .toc{ margin:1.2rem 0 1.6rem 0; padding:1rem; border-radius:.75rem; border:1px solid rgba(255,255,255,.08) }
  .toc__title{ display:block; margin-bottom:.4rem }
  .toc__list{ margin:0; padding-left:1.1rem }
  .toc__list a{text-decoration:none}
  .toc__item--active > a{ font-weight:600; text-decoration:underline }
  html{ scroll-behavior: smooth }
  #content h2, #content h3{ scroll-margin-top: 84px; }
  @media(min-width:1100px){ .toc{ position:sticky; top:76px } }
  .anchor-btn{ margin-left:.5rem; font-size:.85em; opacity:.7; text-decoration:none; border:1px solid currentColor; border-radius:.5rem; padding:.05rem .35rem }
</style>

<script>
(function(){
  try{
    const headings = Array.from(document.querySelectorAll('#content h2, #content h3'));
    const list = document.getElementById('toc-list');
    if (!list || headings.length === 0) return;

    headings.forEach(h => {
      if (!h.id) h.id = h.textContent.trim().toLowerCase().replace(/\s+/g,'-').slice(0,80);
      const li = document.createElement('li');
      li.innerHTML = '<a href="#'+h.id+'">'+ h.textContent +'</a>';
      list.appendChild(li);
      // add small copy-anchor button
      const btn = document.createElement('a');
      btn.className = 'anchor-btn';
      btn.href = '#'+h.id;
      btn.setAttribute('aria-label','Link to this section');
      btn.textContent = 'ยง';
      h.appendChild(btn);
    });

    // highlight active
    const io = new IntersectionObserver((entries)=>{
      entries.forEach(e=>{
        const link = list.querySelector('a[href="#'+e.target.id+'"]');
        if (!link) return;
        link.parentElement.classList.toggle('toc__item--active', e.isIntersecting);
      });
    }, {rootMargin:'-70px 0px -60% 0px', threshold: 0.01});
    headings.forEach(h=>io.observe(h));
  }catch(_){}
})();
</script>
