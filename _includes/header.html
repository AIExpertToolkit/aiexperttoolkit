<header class="site-header" role="banner">
  {% if site.promo_text and site.promo_url %}
  <div class="promo-bar" role="note">
    <a href="{{ site.baseurl }}{{ site.promo_url | replace: site.baseurl,'' }}">{{ site.promo_text }}</a>
  </div>
  {% endif %}

  <div class="wrap header-row">
    <!-- Brand -->
    <a class="brand" href="{{ site.baseurl }}/" aria-label="{{ site.title | default:'AI Expert Toolkit' }} â€” Home">
      {% if site.logo and site.logo != '' %}
        <img src="{{ site.baseurl }}{{ site.logo }}" alt="{{ site.title | default:'AI Expert Toolkit' }}" width="112" height="28" decoding="async">
      {% else %}{{ site.title | default:'AI Expert Toolkit' }}{% endif %}
    </a>

    <!-- Mobile menu toggle -->
    <button class="menu-toggle" type="button" aria-label="Open menu" aria-controls="primary-nav" aria-expanded="false">
      <span class="menu-icon" aria-hidden="true"></span><span class="menu-text">Menu</span>
    </button>

    <!-- Primary navigation -->
    <nav id="primary-nav" class="primary-nav" aria-label="Primary">
      {% assign here = page.url | default: '' %}
      <a href="{{ site.baseurl }}/comparisons.html" {% if here contains '/comparisons' %}aria-current="page"{% endif %}>Comparisons</a>
      <a href="{{ site.baseurl }}/jasper-vs-writesonic.html" {% if here contains '/jasper-vs-writesonic' %}aria-current="page"{% endif %}>Jasper vs Writesonic</a>
      <a href="{{ site.baseurl }}/writesonic-review.html" {% if here contains '/writesonic-review' %}aria-current="page"{% endif %}>Writesonic Review</a>
      <a href="{{ site.baseurl }}/pricing.html" {% if here contains '/pricing' %}aria-current="page"{% endif %}>Pricing</a>
      <a href="{{ site.baseurl }}/about.html" {% if here contains '/about' %}aria-current="page"{% endif %}>About</a>
      <a href="{{ site.baseurl }}/contact.html" {% if here contains '/contact' %}aria-current="page"{% endif %}>Contact</a>
      <a href="{{ site.baseurl }}/consulting.html" {% if here == '/consulting.html' %}aria-current="page"{% endif %}>Consulting</a>
    </nav>

    <!-- CTA -->
    {% if site.header_cta_url %}
      <a class="btn header-cta" href="{{ site.header_cta_url }}" target="_blank"
         rel="{% if site.header_cta_sponsored %}sponsored {% endif %}nofollow noopener"
         data-aff="true" aria-label="{{ site.header_cta_label | default:'Start Free' }}">
        {{ site.header_cta_label | default:'Start Free' }}
      </a>
    {% endif %}

    <!-- Google site: search (no backend) -->
    {% assign sitehost = site.url | replace: 'https://','' | replace: 'http://','' | split:'/' | first %}
    <form class="site-search" action="https://www.google.com/search" method="get" role="search">
      <label class="sr-only" for="q">Search site</label>
      <input id="q" name="q" type="search" placeholder="Search articles & comparisons"
             autocomplete="off" aria-label="Search {{ site.title | default:'AI Expert Toolkit' }}">
      <button class="btn search-btn" type="submit" aria-label="Search">Search</button>
      <input type="hidden" name="hl" value="en">
      <input type="hidden" id="siteScope" value="site:{{ sitehost }}">
    </form>
  </div>

  <script>
  (function(){
    try{
      const header=document.querySelector('.site-header');
      const btn=header.querySelector('.menu-toggle');
      const nav=header.querySelector('#primary-nav');
      let lastFocus=null;
      function setOpen(state){
        header.classList.toggle('is-open', !!state);
        btn.setAttribute('aria-expanded', !!state);
        if(state){ const first=nav.querySelector('a'); first && first.focus({preventScroll:true}); }
        else if(lastFocus){ lastFocus.focus({preventScroll:true}); }
      }
      btn.addEventListener('click', function(){ lastFocus=document.activeElement; setOpen(!header.classList.contains('is-open')); });
      document.addEventListener('keydown', e=>{ if(e.key==='Escape' && header.classList.contains('is-open')) setOpen(false); });
      document.addEventListener('click', e=>{ if(header.classList.contains('is-open') && !header.contains(e.target)) setOpen(false); });

      // site: scope
      const form=header.querySelector('.site-search');
      if(form){ form.addEventListener('submit', function(){
        const q=form.querySelector('#q'); const scope=form.querySelector('#siteScope').value||'';
        if(q && scope && !q.value.trim().startsWith('site:')) q.value = scope + ' ' + q.value.trim();
      }); }
      // NOTE: affiliate UTM + GA handling has been removed from header.
      // Sitewide handling is provided by /assets/js/affiliates.js (loaded in the layout).
    }catch(_){}
  })();
  </script>

  <!-- Optional SiteNavigationElement -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"SiteNavigationElement",
    "name":["Comparisons","Jasper vs Writesonic","Writesonic Review","Pricing","About","Contact","Consulting"],
    "url":[
      "{{ site.url }}{{ site.baseurl }}/comparisons.html",
      "{{ site.url }}{{ site.baseurl }}/jasper-vs-writesonic.html",
      "{{ site.url }}{{ site.baseurl }}/writesonic-review.html",
      "{{ site.url }}{{ site.baseurl }}/pricing.html",
      "{{ site.url }}{{ site.baseurl }}/about.html",
      "{{ site.url }}{{ site.baseurl }}/contact.html",
      "{{ site.url }}{{ site.baseurl }}/consulting.html"
    ]
  }
  </script>
</header>
