{%- comment -%}
Reusable Gumroad buy button with GA4 begin_checkout event + lazy-loaded overlay JS.
Usage example:
{% include buy_button.html
   id:"aetk-sprint-playbook",
   label:"Get the Sprint Playbook",
   price:"4.99",
   url:"https://elijahtoolkit.gumroad.com/l/aetk-sprint-playbook",
   campaign:"sprint-playbook"
%}
{%- endcomment -%}

{%- assign _id = include.id | default: "aetk-sprint-playbook" -%}
{%- assign _label = include.label | default: "Get the Playbook" -%}
{%- assign _price = include.price | default: "4.99" -%}
{%- assign _campaign = include.campaign | default: "sprint-playbook" -%}
{%- assign _url = include.url | default: "" -%}

{%- comment -%} Build URL with overlay + UTM {%- endcomment -%}
{%- assign q = "?wanted=true&utm_source=aiexperttoolkit&utm_medium=gumroad&utm_campaign=" | append: _campaign -%}
{%- assign href = _url | append: q -%}

<div class="buy-cta">
  <a id="buy-{{ _id }}"
     class="btn"
     href="{{ href }}"
     data-id="{{ _id }}"
     data-price="{{ _price }}"
     target="_blank"
     rel="nofollow noopener sponsored"
     aria-label="{{ _label | escape }}">
     {{ _label }}
  </a>
</div>

<script>
(function(){
  try{
    var a = document.getElementById('buy-{{ _id }}');
    if(!a) return;

    // Fire GA4 begin_checkout on click
    a.addEventListener('click', function(){
      try {
        if (typeof gtag === 'function') {
          gtag('event','begin_checkout',{
            currency: 'USD',
            value: parseFloat(a.dataset.price)||4.99,
            items: [{
              item_id: a.dataset.id,
              item_name: '{{ _label | escape }}',
              price: parseFloat(a.dataset.price)||4.99,
              quantity: 1
            }]
          });
        }
      } catch(_) {}

      // Lazy-load Gumroad overlay script only when needed
      if (!window.GumroadOverlay && !document.getElementById('gumroad-js')) {
        var s = document.createElement('script');
        s.id = 'gumroad-js';
        s.src = 'https://gumroad.com/js/gumroad.js';
        s.async = true;
        document.head.appendChild(s);
      }
    }, {passive:true});
  }catch(_){}
})();
</script>
