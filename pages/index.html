<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Photo Splitter — Free & Premium</title>
  <meta name="description" content="Split any photo into a grid of equal tiles in your browser. Free mode up to 2×2. Premium unlocks up to 10×10 and ZIP download.">
  <!-- GA4 -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-6E56LGF5M5"></script>
  <script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)};gtag('js',new Date());gtag('config','G-6E56LGF5M5',{'anonymize_ip':true});</script>
  <style>
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;color:#0f172a;margin:0}
  .section.tool { padding: 2rem 0; }
  .wrap{max-width:980px;margin:0 auto;padding:0 16px}
  h1.tool-title{font-size:clamp(1.6rem,2.8vw,2.2rem);margin:0 0 1rem}
  .lead{color:#555;margin:0 0 1.25rem}
  .note{font-size:.95rem;color:#444;background:#f6f7f8;border:1px solid #e5e7eb;border-radius:10px;padding:10px 12px}
  .row{display:grid;gap:16px}
  @media(min-width:880px){.row{grid-template-columns:1.1fr .9fr}}
  .card{border:1px solid #e5e7eb;border-radius:14px;padding:16px;background:#fff;box-shadow:0 1px 0 rgba(0,0,0,.02)}
  .card h2{font-size:1.1rem;margin:.25rem 0 .5rem}
  label{display:block;font-size:.95rem;margin:.5rem 0 .25rem}
  input[type="number"]{width:100%;padding:8px 10px;border:1px solid #cfd3d8;border-radius:8px}
  input[type="file"]{width:100%}
  .btn-row{display:flex;flex-wrap:wrap;gap:10px;margin-top:12px}
  .btn{display:inline-flex;align-items:center;gap:8px;border:1px solid #0f172a;border-radius:10px;padding:10px 14px;background:#0f172a;color:#fff;font-weight:600;text-decoration:none}
  .btn.secondary{background:#fff;color:#0f172a}
  .btn[disabled]{opacity:.45;cursor:not-allowed}
  .badge{display:inline-flex;align-items:center;gap:8px;border-radius:999px;padding:6px 10px;font-weight:700;font-size:.85rem}
  .badge.free{background:#eef2ff;color:#1e3a8a;border:1px solid #c7d2fe}
  .badge.premium{background:#fff7ed;color:#9a6700;border:1px solid #f4d7b2}
  .helper{font-size:.9rem;color:#555}
  hr.soft{border:none;border-top:1px solid #eee;margin:12px 0}
  .preview{display:grid;place-items:center;background:#fafafa;border:1px dashed #e5e7eb;border-radius:12px;min-height:220px;overflow:auto}
  .preview img{max-width:100%;height:auto;border-radius:8px}
  .outputs{display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:10px;margin-top:12px}
  .tile{border:1px solid #e5e7eb;border-radius:10px;padding:8px;background:#fff;text-align:center}
  .tile a{display:block;margin-top:6px;font-size:.9rem;text-decoration:none;color:#0f172a}
  .toast{position:fixed;right:12px;bottom:12px;background:#0f172a;color:#fff;padding:10px 14px;border-radius:10px;opacity:0;transform:translateY(8px);transition:.25s}
  .toast.show{opacity:1;transform:none}
  .small{font-size:.9rem}
  </style>
</head>
<body>
<section class="section tool">
  <div class="wrap">
    <h1 class="tool-title">Photo Splitter <span class="badge free" id="modeBadge">FREE</span></h1>
    <p class="lead">Split a photo into equal tiles in your browser. <strong>Free:</strong> up to 2×2 with individual downloads. <strong>Premium:</strong> up to 10×10 and ZIP download.</p>
    <div class="note small" id="unlockNote" hidden>
      <strong>Premium unlocked.</strong> Thanks for your purchase — enjoy larger grids and ZIP export.
    </div>

    <div class="row">
      <div class="card">
        <h2>1) Upload &amp; Settings</h2>
        <label for="file">Choose an image</label>
        <input id="file" type="file" accept="image/*">
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:10px">
          <div><label for="rows">Rows</label><input id="rows" type="number" min="1" max="10" value="2"></div>
          <div><label for="cols">Columns</label><input id="cols" type="number" min="1" max="10" value="2"></div>
        </div>

        <div class="btn-row">
          <button id="splitBtn" class="btn" disabled>Split Photo</button>
          <button id="zipBtn" class="btn secondary" disabled>Download ZIP (Premium)</button>
          <a id="buyBtn" class="btn" href="https://buy.stripe.com/00wdR9e8f6S1434cAe8k800" target="_blank" rel="noopener">Buy Premium – $9.99</a>
        </div>

        <p class="helper" id="limitsHelp">Free limit: up to <strong>2×2</strong>. Premium unlocks up to <strong>10×10</strong> and ZIP.</p>
        <hr class="soft">
        <p class="small">Tip: larger source images produce crisper tiles. All processing is done locally in your browser — your image never leaves your device.</p>
      </div>

      <div class="card">
        <h2>2) Preview</h2>
        <div class="preview" id="previewBox"><span class="small" id="noImgMsg">No image yet — upload a photo to begin.</span></div>
      </div>
    </div>

    <div class="card" style="margin-top:16px">
      <h2>3) Results</h2>
      <div id="outputs" class="outputs"></div>
    </div>
  </div>
</section>

<div class="toast" id="toast">Premium unlocked</div>

<script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
<script>
(function(){
  const STRIPE_LINK = "https://buy.stripe.com/00wdR9e8f6S1434cAe8k800";
  const fileInput = document.getElementById('file');
  const rowsInput = document.getElementById('rows');
  const colsInput = document.getElementById('cols');
  const splitBtn = document.getElementById('splitBtn');
  const zipBtn = document.getElementById('zipBtn');
  const buyBtn = document.getElementById('buyBtn');
  const outputs = document.getElementById('outputs');
  const previewBox = document.getElementById('previewBox');
  const noImgMsg = document.getElementById('noImgMsg');
  const modeBadge = document.getElementById('modeBadge');
  const unlockNote = document.getElementById('unlockNote');
  const toast = document.getElementById('toast');

  const FREE_MAX = 2, PREMIUM_MAX = 10;

  function showToast(msg){ toast.textContent = msg; toast.classList.add('show'); setTimeout(()=>toast.classList.remove('show'), 2200); }
  function isPremium(){ return localStorage.getItem('premiumAccess') === '1'; }
  function setPremium(on){ if(on){ localStorage.setItem('premiumAccess','1'); } refreshModeUI(); }
  function refreshModeUI(){
    if(isPremium()){
      modeBadge.textContent='PREMIUM'; modeBadge.className='badge premium';
      zipBtn.disabled=false; unlockNote.hidden=false; buyBtn.style.display='none';
      document.getElementById('limitsHelp').innerHTML='Premium active: up to <strong>'+PREMIUM_MAX+'×'+PREMIUM_MAX+'</strong> and ZIP export.';
    }else{
      modeBadge.textContent='FREE'; modeBadge.className='badge free';
      zipBtn.disabled=true; unlockNote.hidden=true; buyBtn.style.display='inline-flex';
      document.getElementById('limitsHelp').innerHTML='Free limit: up to <strong>'+FREE_MAX+'×'+FREE_MAX+'</strong>. Premium unlocks up to <strong>'+PREMIUM_MAX+'×'+PREMIUM_MAX+'</strong> and ZIP.';
    }
  }
  try{
    const u = new URL(location.href);
    if(u.searchParams.get('premium')==='1'){
      setPremium(true); showToast('Thanks! Premium unlocked.');
      u.searchParams.delete('premium'); history.replaceState({},'',u.toString());
    }
  }catch(e){}
  refreshModeUI();

  let image=null, imageName='image';
  fileInput.addEventListener('change', e=>{
    outputs.innerHTML='';
    const f=e.target.files&&e.target.files[0];
    if(!f){ splitBtn.disabled=true; previewBox.innerHTML='<span class="small">No image</span>'; return; }
    imageName=(f.name||'image').replace(/\.[^.]+$/,'');
    const url=URL.createObjectURL(f);
    const img=new Image();
    img.onload=()=>{ image=img; previewBox.innerHTML=''; previewBox.appendChild(img); img.style.maxHeight='360px'; splitBtn.disabled=false; };
    img.onerror=()=>{ splitBtn.disabled=true; previewBox.innerHTML='<span class="small">Could not load image.</span>'; };
    img.src=url;
  });

  function clampGrid(r,c){ const max=isPremium()?PREMIUM_MAX:FREE_MAX; return {r:Math.max(1,Math.min(max,r)), c:Math.max(1,Math.min(max,c))}; }

  async function splitImage(){
    outputs.innerHTML='';
    if(!image) return;
    const r=parseInt(rowsInput.value||'2',10), c=parseInt(colsInput.value||'2',10);
    const {r:R,c:C}=clampGrid(r,c);
    if((r!==R||c!==C)&&!isPremium()) showToast('Free limit is 2×2. Buy Premium to go bigger.');
    rowsInput.value=R; colsInput.value=C;

    const w=image.naturalWidth, h=image.naturalHeight;
    const tileW=Math.floor(w/C), tileH=Math.floor(h/R);
    const canvases=[];

    for(let row=0; row<R; row++){
      for(let col=0; col<C; col++){
        const sx=col*tileW, sy=row*tileH;
        const cw=(col===C-1)?(w-sx):tileW, ch=(row===R-1)?(h-sy):tileH;

        const cv=document.createElement('canvas'); cv.width=cw; cv.height=ch;
        const ctx=cv.getContext('2d'); ctx.drawImage(image, sx, sy, cw, ch, 0, 0, cw, ch);

        const url=cv.toDataURL('image/png');
        const a=document.createElement('a'); const fname=`${imageName}_r${row+1}c${col+1}.png`;
        a.href=url; a.download=fname; a.textContent='Download';

        const wrap=document.createElement('div'); wrap.className='tile';
        const thumb=new Image(); thumb.src=url; thumb.alt=fname; thumb.style.maxWidth='100%';
        wrap.appendChild(thumb); wrap.appendChild(a); outputs.appendChild(wrap);

        canvases.push({canvas:cv, name:fname});
      }
    }

    if(isPremium()){
      zipBtn.disabled=false;
      zipBtn.onclick=async ()=>{
        zipBtn.disabled=true;
        try{
          const zip=new JSZip();
          for(const item of canvases){
            const blob=await new Promise(res=>item.canvas.toBlob(res,'image/png'));
            zip.file(item.name, blob);
          }
          const out=await zip.generateAsync({type:'blob'});
          const a=document.createElement('a');
          a.href=URL.createObjectURL(out);
          a.download=`${imageName}_tiles_${R}x${C}.zip`;
          a.click();
        } finally { zipBtn.disabled=false; }
      };
    }else{
      zipBtn.disabled=true;
    }
  }

  document.getElementById('splitBtn').addEventListener('click', splitImage);
  document.getElementById('buyBtn').addEventListener('click', (e)=>{ e.currentTarget.href=STRIPE_LINK; });
})();
</script>
</body>
</html>